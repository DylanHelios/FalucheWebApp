version: '3.8'

services:
  neo4j:
    image: ${NEO4J_IMAGE:-neo4j:latest}
    container_name: ${NEO4J_CONTAINER_NAME:-neo4j}
    restart: unless-stopped
    ports:
      - "${NEO4J_HTTP_PORT:-7474}:7474"
      - "${NEO4J_BOLT_PORT:-7687}:7687"
    environment:
      - NEO4J_AUTH=${NEO4J_USER_DB:-neo4j}/${NEO4J_PWD_DB:-password}
      - NEO4J_dbms_memory_heap_initial__size=${NEO4J_HEAP_INIT:-512m}
      - NEO4J_dbms_memory_heap_max__size=${NEO4J_HEAP_MAX:-1g}
      - NEO4J_dbms_memory_pagecache_size=${NEO4J_PAGECACHE:-512m}
    volumes:
      - neo4j_data:/data
      - neo4j_logs:/logs
      - neo4j_import:/import
      - neo4j_plugins:/plugins
    networks:
      - app_network

  fastapi:
    build:
      context: ./API
      dockerfile: Dockerfile
    container_name: fastapi
    restart: unless-stopped
    ports:
      - "${FASTAPI_PORT:-8000}:8000"
    environment:
      - PYTHONPATH=/app
      - NEO4J_URI=bolt://neo4j:7687
      - NEO4J_USER=${NEO4J_USER_DB:-neo4j}
      - NEO4J_PASSWORD=${NEO4J_PWD_DB:-password}
    depends_on:
      - neo4j
    volumes:
      - ./API:/app
    networks:
      - app_network

  web:
    build:
      context: ./web
      dockerfile: Dockerfile
    container_name: web
    restart: unless-stopped
    ports:
      - "${FRONTEND_PORT:-3000}:3000"
    environment:
      - VITE_API_BASE_URL=http://localhost:8000
    depends_on:
      - fastapi
    volumes:
      - ./web:/app
      - web_node_modules:/app/node_modules
    networks:
      - app_network

volumes:
  neo4j_data:
  neo4j_logs:
  neo4j_import:
  neo4j_plugins:
  web_node_modules:

networks:
  app_network:
    driver: bridge